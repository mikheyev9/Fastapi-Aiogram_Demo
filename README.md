FastAPI & Aiogram Demo Project
Описание проекта

Этот проект представляет собой демо-приложение, состоящее из двух частей:

    Backend на FastAPI — предоставляет REST API для управления пользователями, заметками и аутентификации.
    Telegram бот на Aiogram — позволяет пользователям взаимодействовать с сервисом через Telegram.

Проект использует следующие технологии:

    FastAPI — для создания REST API с поддержкой CORS.
    Aiogram — для создания Telegram бота.
    PostgreSQL — база данных для хранения пользователей и заметок.
    Redis — для кэширования и ограничения запросов.
    Docker — для контейнеризации всех сервисов.
    Docker Compose — для упрощения управления многими контейнерами.
    Gunicorn — для запуска FastAPI с поддержкой многопоточности.
    JWT аутентификация — для защиты API запросов.
    Лимитатор запросов — для ограничения частоты запросов к API и Telegram боту.

Основные возможности

    Регистрация и аутентификация пользователей через API FastAPI.
    Управление заметками через API FastAPI.
    Лимитирование запросов (rate limiting) на уровне API и Telegram бота.
    Хранение сессий и данных о лимитах в Redis.
    Автоматическое логирование всех входящих запросов и ошибок.
    Сохранение логов с ротацией по дате.

Используемые технологии

    FastAPI: Для создания REST API.
    Aiogram: Для создания Telegram бота.
    PostgreSQL: Хранение данных о пользователях и заметках.
    Redis: Используется для хранения сессий, кэширования, а также для реализации лимитирования запросов.
    Docker и Docker Compose: Для контейнеризации и управления зависимостями.
    Gunicorn: Для многопоточной обработки запросов FastAPI.

Установка и запуск проекта
1. Клонирование проекта

Склонируйте репозиторий:

bash

git clone https://github.com/ваш-проект/название.git
cd название

2. Настройка переменных окружения

Создайте файл .env на основе примера:

bash

cp .env.example .env

Отредактируйте .env файл, чтобы указать необходимые переменные, такие как данные для подключения к PostgreSQL, Redis, и токен для вашего Telegram бота.
Пример .env файла:

env

# Настройки базы данных PostgreSQL
DB_USER=myuser
DB_PASS=mypassword
DB_HOST=postgres
DB_PORT=5432
DB_NAME=mydatabase
DATABASE_URL=postgresql+asyncpg://${DB_USER}:${DB_PASS}@${DB_HOST}:${DB_PORT}/${DB_NAME}

# Секретные ключи и настройки безопасности
SECRET_KEY=your_secret_key
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# Настройки Redis
REDIS_HOST=redis
REDIS_PORT=6379

# Токен Telegram бота
BOT_TOKEN=1234567890:ABCDEF1234567890abcdef1234567890

# URL API для взаимодействия бота с FastAPI
BASE_URL=http://backend:8000

3. Запуск с помощью Docker Compose

Запустите контейнеры:

bash

make up

Это автоматически установит Docker, если он отсутствует, проверит его версию, и запустит необходимые контейнеры для работы проекта.
4. Остановка контейнеров

Для остановки и удаления контейнеров выполните:

bash

make down

Лимитирование запросов
API (FastAPI):

Проект использует библиотеку fastapi-limiter, которая интегрируется с Redis для ограничения количества запросов от одного пользователя. Лимит установлен на 100 запросов в минуту для каждого пользователя. Эти настройки можно изменить в файле конфигурации.
Telegram бот (Aiogram):

Также реализовано лимитирование запросов для Telegram бота с помощью RateLimitMiddleware, которая ограничивает пользователей до 50 запросов в минуту. Если лимит превышен, бот отправляет сообщение с предупреждением.
Логирование

Проект настраивает логирование с ротацией логов по дате. Логи сохраняются в файле /logs/bot.log для Telegram бота и в отдельной директории для FastAPI приложения.
Дополнительные команды Makefile

    make up: Запуск всех контейнеров.
    make down: Остановка всех контейнеров и удаление ресурсов.
    make logs: Просмотр логов.
    make restart: Перезапуск контейнеров.
    make status: Просмотр статуса контейнеров.

Контейнеризация

Проект использует Docker и Docker Compose для управления зависимостями и изоляции сервисов:

    PostgreSQL для базы данных.
    Redis для хранения сессий и ограничения частоты запросов.
    FastAPI и Aiogram развернуты в отдельных контейнерах и взаимодействуют через сеть my_network.
